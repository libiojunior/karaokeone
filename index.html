<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador de Músicas com Persistência Local</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        /* Estilos Gerais (mantidos da versão anterior) */
        body { background-color: #000; color: #fff; font-family: Arial, sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; }
        .side-menu { position: fixed; top: 0; left: -280px; width: 280px; height: 100%; background-color: #1c1c1c; padding: 20px; box-sizing: border-box; transition: left 0.3s ease; z-index: 200; display: flex; flex-direction: column; border-right: 1px solid #333; }
        .side-menu.open { left: 0; }
        .menu-logo { text-align: center; margin-bottom: 30px; }
        .menu-logo img { width: 150px; height: 150px; border-radius: 50%; border: 3px solid gold; }
        .menu-nav ul { list-style: none; padding: 0; margin: 0; }
        .menu-nav li a { color: #fff; text-decoration: none; padding: 15px 5px; display: block; font-size: 1.1em; border-bottom: 1px solid #2a2a2a; }
        .menu-nav li:last-child a { border-bottom: none; }
        .menu-nav li a:hover { background-color: #333; }
        .menu-footer { margin-top: auto; font-size: 0.8em; text-align: center; color: #ccc; padding-top: 20px; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 100; }
        .overlay.show { display: block; }
        .app-container { flex-grow: 1; display: flex; flex-direction: column; overflow-y: hidden; }
        .app-header { background-color: #1c1c1c; padding: 15px; display: flex; align-items: center; border-bottom: 1px solid #333; min-height: 50px; box-sizing: border-box; }
        .menu-toggle-btn { background: none; border: none; color: #fff; font-size: 1.5em; cursor: pointer; padding: 0 10px; }
        .app-header h1 { font-size: 1.2em; margin: 0; color: #fff; text-align: center; flex-grow: 1; }
        .header-placeholder-right { width: 40px; }
        .search-bar-container { padding: 15px; background-color: #000; }
        #statusCarregamento { text-align: center; font-size: 0.8em; color: #aaa; margin-bottom: 10px; min-height: 1.2em; }
        .search-input-wrapper { display: flex; align-items: center; background-color: #333; border-radius: 25px; padding: 10px 15px; }
        .search-input-wrapper i { margin-right: 10px; color: #ccc; }
        .search-input-wrapper input { flex-grow: 1; background: none; border: none; color: #fff; font-size: 1em; }
        .search-input-wrapper input::placeholder { color: #ccc; }
        .results-area { flex-grow: 1; overflow-y: auto; padding: 0 15px 15px 15px; background-color: #000; }
        .song-item { background-color: #000; padding: 12px 0; margin-bottom: 5px; border-bottom: 1px solid #2a2a2a; }
        .song-item:last-child { border-bottom: none; }
        .song-item .song-code { color: #D32F2F; font-size: 0.9em; display: block; margin-bottom: 3px; }
        .song-item .song-title { font-weight: bold; font-size: 1.1em; color: #fff; margin: 2px 0; }
        .song-item .song-artist, .song-item .song-snippet { font-size: 0.9em; color: #ccc; margin: 2px 0; }
        .bottom-nav { display: flex; justify-content: space-around; background-color: #1c1c1c; padding: 8px 0; border-top: 1px solid #333; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #8e8e93; text-decoration: none; font-size: 0.75em; cursor: pointer; padding: 5px; flex-grow: 1; text-align: center; }
        .nav-item i { font-size: 1.6em; margin-bottom: 3px; }
        .nav-item.active { color: #fff; }
        .btn-favoritar { background-color: #555; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-top: 8px; font-size: 0.85em; transition: background-color 0.2s ease; }
        .btn-favoritar i { margin-right: 5px; }
        .btn-favoritar.favoritado { background-color: #ffc107; color: #000; }
        .btn-favoritar .fa-star::before { font-family: "Font Awesome 5 Free"; font-weight: 400; }
        .btn-favoritar.favoritado .fa-star::before { font-family: "Font Awesome 5 Free"; font-weight: 900; }

        /* Estilos para Modal de Login e Admin */
        .modal { display: none; position: fixed; z-index: 300; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); padding-top: 60px; }
        .modal-content { background-color: #2c2c2c; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 650px; border-radius: 8px; color: #fff; }
        .modal-content h2 { text-align: center; color: gold; }
        .modal-content label { display: block; margin-top: 10px; }
        .modal-content input[type="text"], .modal-content input[type="password"], .modal-content textarea { width: calc(100% - 22px); padding: 10px; margin-top: 5px; margin-bottom: 15px; border: 1px solid #555; background-color: #333; color: #fff; border-radius: 4px; }
        .modal-content textarea#jsonDataTextarea { height: 280px; font-family: monospace; font-size: 0.9em; white-space: pre; }
        .modal-content button { background-color: gold; color: #000; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 1em; margin-right: 10px; margin-top:5px; }
        .modal-content button:hover { background-color: #e6b800; }
        .modal-content .btn-close, .modal-content .btn-secondary { background-color: #555; color: #fff; }
        .modal-content .btn-reset-default { background-color: #dc3545; color: #fff; }
        .modal-content .btn-reset-default:hover { background-color: #c82333; }
        .modal-content .btn-close:hover, .modal-content .btn-secondary:hover { background-color: #777; }
        #loginErrorMessage, #adminStatusMessage { color: #ff6b6b; text-align: center; margin-top: 10px; min-height:1.2em; }
        #adminInfo { font-size: 0.85em; color: #ffc107; border: 1px dashed #ffc107; padding: 10px; margin-top: 15px; border-radius: 4px; line-height: 1.4; }
    </style>
</head>
<body>

    <div id="sideMenu" class="side-menu">
        <div class="menu-logo"><img src="placeholder_logo.png" alt="Logo"></div>
        <nav class="menu-nav">
            <ul>
                <li><a href="#" id="navInicio">Início</a></li>
                <li><a href="#" id="navListaMusicas">Lista de Músicas</a></li>
                <li><a href="#" id="navMinhasFavoritas">Minhas Favoritas</a></li>
                <li><a href="#" id="navCatalogo">Catálogo</a></li>
                <li><a href="#" id="navAdminLogin">Painel Admin</a></li>
                <li><a href="#" id="navContatoMenu">Contato</a></li>
                <li><a href="#" id="navPolitica">Política de Privacidade</a></li>
            </ul>
        </nav>
        <div class="menu-footer"><p>2024 © Videokê</p><p>ABC - Ver.: 2.2</p></div>
    </div>
    <div id="overlay" class="overlay"></div>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2>Login Admin</h2>
            <label for="username">Usuário:</label><input type="text" id="username">
            <label for="password">Senha:</label><input type="password" id="password">
            <button id="btnLogin">Entrar</button>
            <button id="btnCloseLoginModal" class="btn-close">Fechar</button>
            <p id="loginErrorMessage"></p>
        </div>
    </div>

    <div id="adminPanelModal" class="modal">
        <div class="modal-content">
            <h2>Painel de Administração de Dados</h2>
            <label for="jsonDataTextarea">Editar Dados (Formato JSON):</label>
            <textarea id="jsonDataTextarea"></textarea>
            <button id="btnSaveChangesAndPersist">Salvar Alterações (no Navegador)</button>
            <button id="btnDownloadJson">Baixar Backup JSON</button>
            <button id="btnReloadMusicListAdmin">Aplicar e Recarregar Lista</button>
            <button id="btnResetToDefault" class="btn-reset-default">Restaurar Dados Padrão</button>
            <button id="btnCloseAdminPanel" class="btn-close">Fechar Painel</button>
            <p id="adminStatusMessage"></p>
            <div id="adminInfo">
                <strong>Instruções:</strong>
                <ol>
                    <li>Os dados das músicas são exibidos acima em formato JSON. Você pode editá-los diretamente.</li>
                    <li>Clique em "<strong>Salvar Alterações (no Navegador)</strong>" para gravar os dados da caixa de texto no armazenamento local do seu navegador. Essas alterações persistirão ao reabrir a página neste navegador.</li>
                    <li>Clique em "<strong>Aplicar e Recarregar Lista</strong>" para salvar no navegador E atualizar a visualização das músicas no app.</li>
                    <li>Clique em "<strong>Baixar Backup JSON</strong>" para salvar os dados atuais (da caixa de texto) em um arquivo <code>bd_musicas.json</code> no seu computador, como um backup externo.</li>
                    <li>Clique em "<strong>Restaurar Dados Padrão</strong>" para limpar quaisquer dados salvos no navegador e recarregar a lista original embutida no código HTML (da variável <code>embeddedCsvData</code>).</li>
                </ol>
                <strong>Para alterar os dados padrão do aplicativo (que carregam se o navegador estiver limpo ou após restaurar):</strong>
                <p>Você precisa editar a variável <code>embeddedCsvData</code> diretamente no arquivo HTML e salvá-lo. Cole sua lista de músicas em formato CSV dentro desta variável.</p>
            </div>
        </div>
    </div>

    <div class="app-container">
        <header class="app-header">
            <button id="menuToggle" class="menu-toggle-btn"><i class="fas fa-bars"></i></button>
            <h1>Músicas</h1>
            <div class="header-placeholder-right"></div>
        </header>
        <div class="search-bar-container">
            <p id="statusCarregamento">Carregando dados...</p>
            <div class="search-input-wrapper">
                <i class="fas fa-search"></i>
                <input type="text" id="campoBusca" placeholder="Pesquisar música, artista ou código...">
            </div>
        </div>
        <main id="areaResultados" class="results-area">
            <p>Aguarde o carregamento das músicas...</p>
        </main>
        <nav class="bottom-nav">
            <a href="#" class="nav-item active" id="navTabMusicas"><i class="fas fa-music"></i><span>Músicas</span></a>
            <a href="#" class="nav-item" id="navTabFavoritas"><i class="fas fa-star"></i><span>Favoritas</span></a>
            <a href="#" class="nav-item" id="navTabProdutos"><i class="fas fa-shopping-bag"></i><span>Produtos</span></a>
            <a href="#" class="nav-item" id="navTabCompartilhe"><i class="fas fa-share-alt"></i><span>Compartilhe</span></a>
            <a href="#" class="nav-item" id="navTabContato"><i class="fas fa-phone"></i><span>Contato</span></a>
        </nav>
    </div>

    <script>
        // !!!!! ATENÇÃO !!!!!
        // Para definir SUA PRÓPRIA LISTA DE MÚSICAS PADRÃO:
        // 1. Prepare sua lista em formato CSV (primeira linha é o cabeçalho: Numero,Arquivo,Cantor,Musica,TrechoInicial).
        // 2. Substitua o conteúdo de exemplo abaixo (entre as crases ` `) pela SUA lista CSV.
        let embeddedCsvData = `Numero,Arquivo,Cantor,Musica,TrechoInicial
1001,arquivo1.mp3,Artista X,Musica Alpha,Comeco da letra A
1002,arquivo2.mp3,Artista Y,Musica Beta,Comeco da letra B
1003,arquivo3.mp3,Artista X,Musica Gamma,Comeco da letra C
2001,arquivo4.mp3,Cantor Z,Canção Delta,"Era uma vez, um lugarzinho..."
2002,arquivo5.mp3,Banda W,Melodia Epsilon,"No meio da noite, com estrelas..."
7000,VS7000.mp4,Abba,Dancing Queen,"You can dance, you can jive..."
7001,VS7001.mp4,Adele,Someone Like You,"I heard that you're settled down..."`;

        const LOCAL_STORAGE_KEY = 'karaokeAppMusicasData'; 

        document.addEventListener('DOMContentLoaded', () => {
            const menuToggle = document.getElementById('menuToggle');
            const sideMenu = document.getElementById('sideMenu');
            const overlay = document.getElementById('overlay');
            const campoBusca = document.getElementById('campoBusca');
            const areaResultadosPrincipal = document.getElementById('areaResultados');
            const bottomNavItems = document.querySelectorAll('.bottom-nav .nav-item');
            const statusCarregamentoEl = document.getElementById('statusCarregamento');

            const navAdminLogin = document.getElementById('navAdminLogin');
            const loginModal = document.getElementById('loginModal');
            const btnLogin = document.getElementById('btnLogin');
            const btnCloseLoginModal = document.getElementById('btnCloseLoginModal');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const loginErrorMessage = document.getElementById('loginErrorMessage');

            const adminPanelModal = document.getElementById('adminPanelModal');
            const jsonDataTextarea = document.getElementById('jsonDataTextarea');
            const btnSaveChangesAndPersist = document.getElementById('btnSaveChangesAndPersist'); 
            const btnDownloadJson = document.getElementById('btnDownloadJson');
            const btnReloadMusicListAdmin = document.getElementById('btnReloadMusicListAdmin');
            const btnResetToDefault = document.getElementById('btnResetToDefault'); 
            const btnCloseAdminPanel = document.getElementById('btnCloseAdminPanel');
            const adminStatusMessage = document.getElementById('adminStatusMessage');

            let baseDeMusicas = [];
            let favoritos = [];
            let debounceTimer;

            function openMenu() { sideMenu.classList.add('open'); overlay.classList.add('show'); }
            function closeMenu() { sideMenu.classList.remove('open'); overlay.classList.remove('show'); }

            if (menuToggle && sideMenu && overlay) {
                menuToggle.addEventListener('click', (event) => { event.stopPropagation(); sideMenu.classList.toggle('open'); overlay.classList.toggle('show'); });
                overlay.addEventListener('click', closeMenu);
                sideMenu.querySelectorAll('a:not(#navAdminLogin)').forEach(link => link.addEventListener('click', closeMenu));
                window.addEventListener('keydown', (e) => (e.key === 'Escape' && sideMenu.classList.contains('open')) && closeMenu());
            }

            function updateStatus(message, element = statusCarregamentoEl, isError = false, isSuccess = false) {
                if (element) {
                    element.textContent = message;
                    if (isError) element.style.color = '#ff6b6b';
                    else if (isSuccess) element.style.color = '#4CAF50';
                    else element.style.color = '#aaa';
                }
                console.log(message);
            }

            function carregarDadosIniciais() {
                const dadosSalvos = localStorage.getItem(LOCAL_STORAGE_KEY);
                let carregadoDoLocalStorage = false;

                if (dadosSalvos) {
                    try {
                        const dadosJson = JSON.parse(dadosSalvos);
                        if (Array.isArray(dadosJson)) {
                            baseDeMusicas = dadosJson;
                            updateStatus(`Dados carregados do armazenamento local (${baseDeMusicas.length} músicas).`, statusCarregamentoEl, false, true);
                            carregadoDoLocalStorage = true;
                        } else {
                            updateStatus("Formato inválido no armaz. local. Usando padrão.", statusCarregamentoEl, true);
                        }
                    } catch (e) {
                        console.error("Erro ao carregar do LocalStorage:", e);
                        updateStatus("Erro no armaz. local. Usando padrão.", statusCarregamentoEl, true);
                    }
                }

                if (!carregadoDoLocalStorage) {
                    updateStatus("Carregando dados padrão (CSV embutido)...", statusCarregamentoEl);
                    try {
                        baseDeMusicas = parseCSV(embeddedCsvData);
                        updateStatus(`Dados padrão carregados (${baseDeMusicas.length} músicas).`, statusCarregamentoEl);
                        if (baseDeMusicas.length > 0 || embeddedCsvData.trim().split(/\r?\n/).length <=1 ) {
                             localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(baseDeMusicas));
                             updateStatus(`Dados padrão carregados e salvos no armaz. local (${baseDeMusicas.length} músicas).`, statusCarregamentoEl, false, true);
                        } else {
                             updateStatus("CSV embutido parece mal formatado ou vazio após cabeçalho. Não salvo no armaz. local.", statusCarregamentoEl, true);
                        }
                    } catch (e) {
                        console.error("Erro ao processar CSV embutido:", e);
                        updateStatus("Erro crítico ao processar CSV padrão.", statusCarregamentoEl, true);
                        baseDeMusicas = []; 
                    }
                }
                refreshCurrentView();
            }

            function parseCSV(text) {
                const linhas = text.trim().split(/\r?\n/);
                if (linhas.length < 1) { return []; }
                if (linhas.length === 1 && linhas[0].trim() === "") return [];

                const cabecalho = linhas[0].split(',').map(header => header.trim());
                if (cabecalho.length === 0 || (cabecalho.length === 1 && cabecalho[0] === "" && linhas.length === 1)) {
                     if (linhas.length === 1) return [];
                     console.warn("CSV com cabeçalho inválido ou vazio.");
                     return [];
                }
                const dados = [];
                for (let i = 1; i < linhas.length; i++) {
                    const linhaAtual = linhas[i].trim();
                    if (linhaAtual === "") continue;
                    const valores = [];
                    let valorAtual = '';
                    let dentroDeAspas = false;
                    for (let char of linhaAtual) {
                        if (char === '"' && (valorAtual.length === 0 || valorAtual[valorAtual.length - 1] !== '\\')) {
                            dentroDeAspas = !dentroDeAspas;
                        } else if (char === ',' && !dentroDeAspas) {
                            valores.push(valorAtual.trim().replace(/^"|"$/g, '').replace(/""/g, '"'));
                            valorAtual = '';
                        } else {
                            valorAtual += char;
                        }
                    }
                    valores.push(valorAtual.trim().replace(/^"|"$/g, '').replace(/""/g, '"'));
                    if (valores.length === cabecalho.length) {
                        const musica = {};
                        for (let j = 0; j < cabecalho.length; j++) {
                            musica[cabecalho[j]] = valores[j];
                        }
                        dados.push(musica);
                    } else {
                         console.warn(`Linha CSV ignorada (colunas não batem "${cabecalho.length}" vs "${valores.length}"):`, linhaAtual);
                    }
                }
                return dados;
            }

            function realizarBusca() {
                if (!areaResultadosPrincipal) return;
                 if (baseDeMusicas.length === 0 && !localStorage.getItem(LOCAL_STORAGE_KEY) && embeddedCsvData.trim() === "") {
                    areaResultadosPrincipal.innerHTML = '<p>Nenhuma música configurada. Adicione dados pelo Painel Admin ou no código HTML.</p>';
                    return;
                } else if (baseDeMusicas.length === 0) {
                    areaResultadosPrincipal.innerHTML = '<p>Nenhuma música encontrada nos dados atuais.</p>';
                    return;
                }
                const termo = campoBusca.value.toLowerCase().trim();
                if (!termo) {
                    areaResultadosPrincipal.innerHTML = '<p>Digite algo para pesquisar...</p>';
                    return;
                }
                const resultadosFiltrados = baseDeMusicas.filter(musica => {
                    const numero = String(musica.Numero || '').toLowerCase();
                    const arquivo = String(musica.Arquivo || '').toLowerCase();
                    const cantor = String(musica.Cantor || '').toLowerCase();
                    const titulo = String(musica.Musica || '').toLowerCase();
                    return numero.includes(termo) || cantor.includes(termo) || titulo.includes(termo) || arquivo.includes(termo);
                });
                exibirResultados(resultadosFiltrados, areaResultadosPrincipal);
            }

            function exibirResultados(resultados, container) {
                 if (!container) return;
                container.innerHTML = '';
                if (resultados.length === 0) {
                    container.innerHTML = '<p>Nenhum resultado encontrado.</p>';
                    return;
                }
                resultados.forEach(musica => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'song-item';
                    const musicaId = musica.Numero || `${musica.Musica}_${musica.Cantor}`;
                    itemDiv.innerHTML = `
                        <span class="song-code">Código: ${musica.Numero || 'N/D'}</span>
                        <h3 class="song-title">${musica.Musica || 'Título Desconhecido'}</h3>
                        <p class="song-artist">Cantor: ${musica.Cantor || 'Artista Desconhecido'}</p>
                        <p class="song-snippet">Arquivo: ${musica.Arquivo || 'Não informado'}</p>
                        <p class="song-snippet">Início: ${musica.TrechoInicial || 'Não disponível'}</p>
                        <button class="btn-favoritar" data-id="${musicaId}">
                            <i class="fas fa-star"></i> <span>Favoritar</span>
                        </button>
                    `;
                    container.appendChild(itemDiv);
                    const btnFavoritar = itemDiv.querySelector('.btn-favoritar');
                    btnFavoritar.addEventListener('click', toggleFavoritoHandler);
                    atualizarStatusBotaoFavorito(btnFavoritar, musicaId);
                });
            }

            function carregarFavoritosDoLocalStorage() {
                 const favoritosSalvos = localStorage.getItem('appMusicasFavoritos'); 
                favoritos = favoritosSalvos ? JSON.parse(favoritosSalvos) : [];
            }
            function salvarFavoritosNoLocalStorage() {
                localStorage.setItem('appMusicasFavoritos', JSON.stringify(favoritos));
            }
            function toggleFavoritoHandler(event) {
                const botao = event.currentTarget;
                const musicaId = botao.dataset.id;
                if (!musicaId) return;

                const index = favoritos.indexOf(musicaId);
                if (index > -1) {
                    favoritos.splice(index, 1);
                } else {
                    favoritos.push(musicaId);
                }
                salvarFavoritosNoLocalStorage();
                atualizarStatusBotaoFavorito(botao, musicaId);

                if (document.querySelector('.bottom-nav .nav-item.active').id === 'navTabFavoritas') {
                    exibirTodasAsMusicasFavoritas();
                }
            }
            function atualizarStatusBotaoFavorito(botao, musicaId) {
                 if (!botao || !musicaId) return;
                const texto = botao.querySelector('span');
                if (favoritos.includes(musicaId)) {
                    botao.classList.add('favoritado');
                    if (texto) texto.textContent = 'Desfavoritar';
                } else {
                    botao.classList.remove('favoritado');
                    if (texto) texto.textContent = 'Favoritar';
                }
            }
            function exibirTodasAsMusicasFavoritas() {
                 if (!areaResultadosPrincipal) return;
                areaResultadosPrincipal.innerHTML = '';

                const headerFavoritas = document.createElement('h2');
                headerFavoritas.textContent = 'Minhas Favoritas';
                areaResultadosPrincipal.appendChild(headerFavoritas);

                if (baseDeMusicas.length === 0 && !localStorage.getItem(LOCAL_STORAGE_KEY) && embeddedCsvData.trim() === "") {
                     areaResultadosPrincipal.innerHTML += '<p>Nenhuma música configurada para listar favoritos.</p>';
                    return;
                } else if (baseDeMusicas.length === 0) {
                     areaResultadosPrincipal.innerHTML += '<p>A base de músicas está vazia.</p>';
                     return
                }
                if (favoritos.length === 0) {
                    areaResultadosPrincipal.innerHTML += '<p>Você ainda não adicionou nenhuma música aos favoritos.</p>';
                    return;
                }
                const musicasFavoritasVisiveis = baseDeMusicas.filter(musica => {
                    const musicaId = musica.Numero || `${musica.Musica}_${musica.Cantor}`;
                    return favoritos.includes(String(musicaId));
                });

                if (musicasFavoritasVisiveis.length === 0) {
                    areaResultadosPrincipal.innerHTML += '<p>Nenhuma música favorita para exibir no momento.</p>';
                    return;
                }
                exibirResultados(musicasFavoritasVisiveis, areaResultadosPrincipal);
            }

            function refreshCurrentView() {
                const activeTabLink = document.querySelector('.bottom-nav .nav-item.active');
                const activeTabId = activeTabLink ? activeTabLink.id : 'navTabMusicas'; // Padrão para 'navTabMusicas' se nada estiver ativo

                if (activeTabId === 'navTabMusicas') {
                    if (baseDeMusicas.length === 0 && !localStorage.getItem(LOCAL_STORAGE_KEY) && embeddedCsvData.trim() === "") {
                        areaResultadosPrincipal.innerHTML = '<p>Nenhuma música configurada. Adicione dados no Painel Admin ou no código HTML.</p>';
                    } else if (baseDeMusicas.length === 0) {
                         areaResultadosPrincipal.innerHTML = '<p>Nenhuma música encontrada nos dados atuais. Use o Painel Admin para adicionar.</p>';
                    } else if (campoBusca.value.trim() !== '') {
                        realizarBusca();
                    } else {
                        areaResultadosPrincipal.innerHTML = '<p>Digite algo para pesquisar...</p>';
                    }
                } else if (activeTabId === 'navTabFavoritas') {
                    exibirTodasAsMusicasFavoritas();
                } else {
                     const activeTabSpan = activeTabLink ? activeTabLink.querySelector('span') : null;
                     const tabName = activeTabSpan ? activeTabSpan.textContent : "Conteúdo";
                     if (areaResultadosPrincipal) areaResultadosPrincipal.innerHTML = `<h2>${tabName}</h2><p>Conteúdo para ${tabName}...</p>`;
                }
            }

            // --- Lógica do Admin ---
            if (navAdminLogin) navAdminLogin.addEventListener('click', (e) => { e.preventDefault(); loginModal.style.display = 'block'; loginErrorMessage.textContent = ''; usernameInput.value = ''; passwordInput.value = ''; closeMenu(); }); // Limpa campos ao abrir
            if (btnCloseLoginModal) btnCloseLoginModal.addEventListener('click', () => { loginModal.style.display = 'none'; });

            if (btnLogin) {
                btnLogin.addEventListener('click', () => {
                    if (usernameInput.value === 'admin' && passwordInput.value === 'admin') {
                        loginModal.style.display = 'none';
                        adminPanelModal.style.display = 'block';
                        jsonDataTextarea.value = JSON.stringify(baseDeMusicas, null, 2);
                        updateStatus('Dados atuais carregados como JSON para edição.', adminStatusMessage, false, true);
                    } else {
                        loginErrorMessage.textContent = 'Usuário ou senha inválidos!';
                    }
                });
            }
            if (btnCloseAdminPanel) btnCloseAdminPanel.addEventListener('click', () => { adminPanelModal.style.display = 'none'; });

            if (btnSaveChangesAndPersist) {
                btnSaveChangesAndPersist.addEventListener('click', () => {
                    try {
                        const dadosDoPainel = JSON.parse(jsonDataTextarea.value);
                        if (Array.isArray(dadosDoPainel)) {
                            baseDeMusicas = dadosDoPainel;
                            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(baseDeMusicas));
                            updateStatus(`Dados salvos no navegador (${baseDeMusicas.length} músicas).`, adminStatusMessage, false, true);
                        } else {
                            updateStatus('Erro: O JSON deve ser um array de músicas.', adminStatusMessage, true);
                        }
                    } catch (e) {
                        updateStatus(`Erro ao processar JSON: ${e.message}`, adminStatusMessage, true);
                    }
                });
            }

            if (btnDownloadJson) {
                btnDownloadJson.addEventListener('click', () => {
                    try {
                        const dadosParaBaixar = JSON.parse(jsonDataTextarea.value); 
                        if (!Array.isArray(dadosParaBaixar)){
                             updateStatus('Conteúdo da área de texto não é um JSON Array válido para download.', adminStatusMessage, true);
                             return;
                        }
                        const jsonString = JSON.stringify(dadosParaBaixar, null, 2);
                        const blob = new Blob([jsonString], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'bd_musicas.json';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        updateStatus('Arquivo JSON de backup pronto para download.', adminStatusMessage, false, true);
                    } catch (e) {
                         updateStatus(`Erro ao preparar JSON para download: ${e.message}`, adminStatusMessage, true);
                    }
                });
            }

            if (btnReloadMusicListAdmin) {
                btnReloadMusicListAdmin.addEventListener('click', () => {
                    try {
                        const dadosDoPainel = JSON.parse(jsonDataTextarea.value);
                        if (Array.isArray(dadosDoPainel)) {
                            baseDeMusicas = dadosDoPainel; 
                            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(baseDeMusicas)); 
                            updateStatus(`Dados aplicados (${baseDeMusicas.length} músicas). Recarregando visualização...`, adminStatusMessage, false, true);
                            refreshCurrentView();
                        } else {
                             updateStatus('Erro: O JSON da área de texto deve ser um array.', adminStatusMessage, true);
                        }
                    } catch (e) {
                        updateStatus(`Erro ao processar JSON para recarregar: ${e.message}`, adminStatusMessage, true);
                    }
                });
            }

            if (btnResetToDefault) {
                btnResetToDefault.addEventListener('click', () => {
                    if (confirm("Tem certeza que deseja apagar os dados salvos no navegador e restaurar a lista padrão embutida no código?")) {
                        localStorage.removeItem(LOCAL_STORAGE_KEY);
                        updateStatus("Armazenamento local limpo. Recarregando dados padrão...", adminStatusMessage, false, true);
                        // Limpa os campos de login também, se desejar, mas não é estritamente necessário aqui
                        // usernameInput.value = ''; passwordInput.value = ''; 
                        carregarDadosIniciais(); 
                        if (adminPanelModal.style.display === 'block') { // Atualiza a textarea se o painel admin estiver aberto
                            jsonDataTextarea.value = JSON.stringify(baseDeMusicas, null, 2);
                        }
                    }
                });
            }

            window.onclick = function(event) {
                if (event.target == loginModal) loginModal.style.display = "none";
                if (event.target == adminPanelModal) adminPanelModal.style.display = "none";
            }

            // --- Inicialização ---
            carregarFavoritosDoLocalStorage(); 
            carregarDadosIniciais(); 

            if (campoBusca) campoBusca.addEventListener('input', () => { clearTimeout(debounceTimer); debounceTimer = setTimeout(realizarBusca, 300); });

            bottomNavItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    bottomNavItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    if (campoBusca) campoBusca.value = '';
                    refreshCurrentView();
                });
            });
        });
    </script>

</body>
</html>
