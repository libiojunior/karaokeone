<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador de Músicas Interno com Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        /* Estilos Gerais (mantidos da versão anterior) */
        body { background-color: #000; color: #fff; font-family: Arial, sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; }
        .side-menu { position: fixed; top: 0; left: -280px; width: 280px; height: 100%; background-color: #1c1c1c; padding: 20px; box-sizing: border-box; transition: left 0.3s ease; z-index: 200; display: flex; flex-direction: column; border-right: 1px solid #333; }
        .side-menu.open { left: 0; }
        .menu-logo { text-align: center; margin-bottom: 30px; }
        .menu-logo img { width: 150px; height: 150px; border-radius: 50%; border: 3px solid gold; }
        .menu-nav ul { list-style: none; padding: 0; margin: 0; }
        .menu-nav li a { color: #fff; text-decoration: none; padding: 15px 5px; display: block; font-size: 1.1em; border-bottom: 1px solid #2a2a2a; }
        .menu-nav li:last-child a { border-bottom: none; }
        .menu-nav li a:hover { background-color: #333; }
        .menu-footer { margin-top: auto; font-size: 0.8em; text-align: center; color: #ccc; padding-top: 20px; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 100; }
        .overlay.show { display: block; }
        .app-container { flex-grow: 1; display: flex; flex-direction: column; overflow-y: hidden; }
        .app-header { background-color: #1c1c1c; padding: 15px; display: flex; align-items: center; border-bottom: 1px solid #333; min-height: 50px; box-sizing: border-box; }
        .menu-toggle-btn { background: none; border: none; color: #fff; font-size: 1.5em; cursor: pointer; padding: 0 10px; }
        .app-header h1 { font-size: 1.2em; margin: 0; color: #fff; text-align: center; flex-grow: 1; }
        .header-placeholder-right { width: 40px; }
        .search-bar-container { padding: 15px; background-color: #000; }
        #statusCarregamento { text-align: center; font-size: 0.8em; color: #aaa; margin-bottom: 10px; min-height: 1.2em; }
        .search-input-wrapper { display: flex; align-items: center; background-color: #333; border-radius: 25px; padding: 10px 15px; }
        .search-input-wrapper i { margin-right: 10px; color: #ccc; }
        .search-input-wrapper input { flex-grow: 1; background: none; border: none; color: #fff; font-size: 1em; }
        .search-input-wrapper input::placeholder { color: #ccc; }
        .results-area { flex-grow: 1; overflow-y: auto; padding: 0 15px 15px 15px; background-color: #000; }
        .song-item { background-color: #000; padding: 12px 0; margin-bottom: 5px; border-bottom: 1px solid #2a2a2a; }
        .song-item:last-child { border-bottom: none; }
        .song-item .song-code { color: #D32F2F; font-size: 0.9em; display: block; margin-bottom: 3px; }
        .song-item .song-title { font-weight: bold; font-size: 1.1em; color: #fff; margin: 2px 0; }
        .song-item .song-artist, .song-item .song-snippet { font-size: 0.9em; color: #ccc; margin: 2px 0; }
        .bottom-nav { display: flex; justify-content: space-around; background-color: #1c1c1c; padding: 8px 0; border-top: 1px solid #333; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #8e8e93; text-decoration: none; font-size: 0.75em; cursor: pointer; padding: 5px; flex-grow: 1; text-align: center; }
        .nav-item i { font-size: 1.6em; margin-bottom: 3px; }
        .nav-item.active { color: #fff; }
        .btn-favoritar { background-color: #555; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-top: 8px; font-size: 0.85em; transition: background-color 0.2s ease; }
        .btn-favoritar i { margin-right: 5px; }
        .btn-favoritar.favoritado { background-color: #ffc107; color: #000; }
        .btn-favoritar .fa-star::before { font-family: "Font Awesome 5 Free"; font-weight: 400; }
        .btn-favoritar.favoritado .fa-star::before { font-family: "Font Awesome 5 Free"; font-weight: 900; }

        /* Estilos para Modal de Login e Admin */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 300; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.7); /* Black w/ opacity */
            padding-top: 60px;
        }
        .modal-content {
            background-color: #2c2c2c;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
            color: #fff;
        }
        .modal-content h2 {
            text-align: center;
            color: gold;
        }
        .modal-content label {
            display: block;
            margin-top: 10px;
        }
        .modal-content input[type="text"],
        .modal-content input[type="password"],
        .modal-content textarea {
            width: calc(100% - 22px);
            padding: 10px;
            margin-top: 5px;
            margin-bottom: 15px;
            border: 1px solid #555;
            background-color: #333;
            color: #fff;
            border-radius: 4px;
        }
        .modal-content textarea {
            height: 200px;
            font-family: monospace;
            font-size: 0.9em;
            white-space: pre; /* Mantém a formatação do CSV */
        }
        .modal-content button {
            background-color: gold;
            color: #000;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            margin-right: 10px;
        }
        .modal-content button:hover {
            background-color: #e6b800;
        }
        .modal-content .btn-close, .modal-content .btn-secondary {
            background-color: #555;
            color: #fff;
        }
        .modal-content .btn-close:hover, .modal-content .btn-secondary:hover {
            background-color: #777;
        }
        #loginErrorMessage, #adminStatusMessage {
            color: #ff6b6b; /* Vermelho claro para erros */
            text-align: center;
            margin-top: 10px;
        }
        #adminInfo {
            font-size: 0.85em;
            color: #ffc107; /* Amarelo */
            border: 1px dashed #ffc107;
            padding: 10px;
            margin-top: 15px;
            border-radius: 4px;
            line-height: 1.4;
        }

    </style>
</head>
<body>

    <div id="sideMenu" class="side-menu">
        <div class="menu-logo">
            <img src="placeholder_logo.png" alt="Logo">
        </div>
        <nav class="menu-nav">
            <ul>
                <li><a href="#" id="navInicio">Início</a></li>
                <li><a href="#" id="navListaMusicas">Lista de Músicas</a></li>
                <li><a href="#" id="navMinhasFavoritas">Minhas Favoritas</a></li>
                <li><a href="#" id="navCatalogo">Catálogo</a></li>
                <li><a href="#" id="navAdminLogin">Painel Admin</a></li> <li><a href="#" id="navContatoMenu">Contato</a></li>
                <li><a href="#" id="navPolitica">Política de Privacidade</a></li>
            </ul>
        </nav>
        <div class="menu-footer">
            <p>2023 © Videokê</p>
            <p>ABC - Ver.: 2.0</p>
        </div>
    </div>
    <div id="overlay" class="overlay"></div>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2>Login Admin</h2>
            <label for="username">Usuário:</label>
            <input type="text" id="username" value="admin">
            <label for="password">Senha:</label>
            <input type="password" id="password" value="admin">
            <button id="btnLogin">Entrar</button>
            <button id="btnCloseLoginModal" class="btn-close">Fechar</button>
            <p id="loginErrorMessage"></p>
        </div>
    </div>

    <div id="adminPanelModal" class="modal">
        <div class="modal-content">
            <h2>Painel de Administração de Dados</h2>
            <label for="csvDataTextarea">Editar Dados CSV Embutidos:</label>
            <textarea id="csvDataTextarea"></textarea>
            <button id="btnSaveChangesToSession">Salvar Alterações na Sessão</button>
            <button id="btnReloadMusicListAdmin">Recarregar Lista de Músicas</button>
            <button id="btnCloseAdminPanel" class="btn-close">Fechar Painel</button>
            <p id="adminStatusMessage"></p>
            <div id="adminInfo">
                <strong>Importante:</strong> As alterações feitas aqui são aplicadas <strong>apenas para a sessão atual</strong> do navegador.
                Para torná-las permanentes, você deve:
                <ol>
                    <li>Clicar em "Salvar Alterações na Sessão".</li>
                    <li>Selecionar TODO o texto dentro desta caixa de edição.</li>
                    <li>Copiar o texto (Ctrl+C ou Cmd+C).</li>
                    <li>Abrir o arquivo HTML deste aplicativo no seu editor de código.</li>
                    <li>Colar o texto copiado para dentro da variável <code>embeddedCsvData</code>, substituindo o conteúdo antigo.</li>
                    <li>Salvar o arquivo HTML.</li>
                </ol>
            </div>
        </div>
    </div>


    <div class="app-container">
        <header class="app-header">
            <button id="menuToggle" class="menu-toggle-btn"><i class="fas fa-bars"></i></button>
            <h1>Músicas</h1>
            <div class="header-placeholder-right"></div>
        </header>

        <div class="search-bar-container">
            <p id="statusCarregamento">Dados internos carregados.</p>
            <div class="search-input-wrapper">
                <i class="fas fa-search"></i>
                <input type="text" id="campoBusca" placeholder="Pesquisar música, artista ou código...">
            </div>
        </div>

        <main id="areaResultados" class="results-area">
            <p>Digite algo para pesquisar as músicas disponíveis.</p>
        </main>

        <nav class="bottom-nav">
            <a href="#" class="nav-item active" id="navTabMusicas">
                <i class="fas fa-music"></i>
                <span>Músicas</span>
            </a>
            <a href="#" class="nav-item" id="navTabFavoritas">
                <i class="fas fa-star"></i>
                <span>Favoritas</span>
            </a>
            <a href="#" class="nav-item" id="navTabProdutos">
                <i class="fas fa-shopping-bag"></i>
                <span>Produtos</span>
            </a>
            <a href="#" class="nav-item" id="navTabCompartilhe">
                <i class="fas fa-share-alt"></i>
                <span>Compartilhe</span>
            </a>
            <a href="#" class="nav-item" id="navTabContato">
                <i class="fas fa-phone"></i>
                <span>Contato</span>
            </a>
        </nav>
    </div>

    <script>
        // !!! IMPORTANTE !!!
        // ESTA É A STRING QUE SERÁ EDITADA PELO PAINEL ADMIN (APENAS NA SESSÃO ATUAL)
        // PARA ALTERAÇÕES PERMANENTES, VEJA AS INSTRUÇÕES NO PAINEL ADMIN.
        let embeddedCsvData = `Numero,Arquivo,Cantor,Musica,TrechoInicial
1001,arquivo1.mp3,Artista X,Musica Alpha,Comeco da letra A
1002,arquivo2.mp3,Artista Y,Musica Beta,Comeco da letra B
1003,arquivo3.mp3,Artista X,Musica Gamma,Comeco da letra C
2001,arquivo4.mp3,Cantor Z,Canção Delta,"Era uma vez, um lugarzinho..."
2002,arquivo5.mp3,Banda W,Melodia Epsilon,"No meio da noite, com estrelas..."
7000,VS7000.mp4,Abba,Dancing Queen,"You can dance, you can jive..."
7001,VS7001.mp4,Adele,Someone Like You,"I heard that you're settled down..."`;

        document.addEventListener('DOMContentLoaded', () => {
            const menuToggle = document.getElementById('menuToggle');
            const sideMenu = document.getElementById('sideMenu');
            const overlay = document.getElementById('overlay');
            const campoBusca = document.getElementById('campoBusca');
            const areaResultadosPrincipal = document.getElementById('areaResultados');
            const bottomNavItems = document.querySelectorAll('.bottom-nav .nav-item');
            const statusCarregamentoEl = document.getElementById('statusCarregamento');

            // Elementos do Modal de Login
            const navAdminLogin = document.getElementById('navAdminLogin');
            const loginModal = document.getElementById('loginModal');
            const btnLogin = document.getElementById('btnLogin');
            const btnCloseLoginModal = document.getElementById('btnCloseLoginModal');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const loginErrorMessage = document.getElementById('loginErrorMessage');

            // Elementos do Modal Admin
            const adminPanelModal = document.getElementById('adminPanelModal');
            const csvDataTextarea = document.getElementById('csvDataTextarea');
            const btnSaveChangesToSession = document.getElementById('btnSaveChangesToSession');
            const btnReloadMusicListAdmin = document.getElementById('btnReloadMusicListAdmin');
            const btnCloseAdminPanel = document.getElementById('btnCloseAdminPanel');
            const adminStatusMessage = document.getElementById('adminStatusMessage');


            let baseDeMusicas = [];
            let favoritos = [];
            let debounceTimer;

            function openMenu() {
                sideMenu.classList.add('open');
                overlay.classList.add('show');
            }

            function closeMenu() {
                sideMenu.classList.remove('open');
                overlay.classList.remove('show');
            }

            if (menuToggle && sideMenu && overlay) {
                menuToggle.addEventListener('click', (event) => {
                    event.stopPropagation();
                    sideMenu.classList.toggle('open');
                    overlay.classList.toggle('show');
                });
                overlay.addEventListener('click', closeMenu);
                sideMenu.querySelectorAll('a:not(#navAdminLogin)').forEach(link => link.addEventListener('click', closeMenu)); // Não fecha o menu ao clicar em Admin
                window.addEventListener('keydown', (e) => (e.key === 'Escape' && sideMenu.classList.contains('open')) && closeMenu());
            }

            function updateStatus(message, element = statusCarregamentoEl, isError = false) {
                if (element) {
                    element.textContent = message;
                    element.style.color = isError ? '#ff6b6b' : '#aaa'; // Vermelho para erro, cinza para normal
                     if (element === adminStatusMessage && !isError) element.style.color = '#4CAF50'; // Verde para sucesso no admin
                }
                console.log(message);
            }

            function carregarDadosEmbutidos() {
                updateStatus("Carregando dados internos...", statusCarregamentoEl);
                try {
                    baseDeMusicas = parseCSV(embeddedCsvData); // Usa a variável global que pode ser alterada pelo admin
                    console.log("Base de músicas processada:", baseDeMusicas.length, "itens.");
                    updateStatus(`Dados internos carregados: ${baseDeMusicas.length} músicas.`, statusCarregamentoEl);

                    if (baseDeMusicas.length === 0 && embeddedCsvData.trim() !== '') {
                        areaResultadosPrincipal.innerHTML = '<p style="color:orange;">Os dados CSV embutidos parecem estar vazios ou em formato incorreto após o cabeçalho.</p>';
                        updateStatus("Aviso: Dados embutidos resultaram em 0 músicas.", statusCarregamentoEl, true);
                    } else if (campoBusca.value.trim() === '' && document.querySelector('.bottom-nav .nav-item.active').id === 'navTabMusicas') {
                        areaResultadosPrincipal.innerHTML = '<p>Digite algo para pesquisar as músicas disponíveis.</p>';
                    } else {
                        realizarBusca();
                    }
                } catch (parseError) {
                    console.error("Falha ao processar o CSV embutido:", parseError);
                    updateStatus(`Erro ao processar dados internos.`, statusCarregamentoEl, true);
                    if (areaResultadosPrincipal) {
                        areaResultadosPrincipal.innerHTML = `<p style="color:red;">Erro ao processar os dados internos das músicas. Verifique o formato do CSV embutido no código.</p>`;
                    }
                }
            }

            function parseCSV(text) {
                const linhas = text.trim().split(/\r?\n/);
                if (linhas.length < 1) { return []; } // Pode não ter cabeçalho se for apenas uma string vazia
                if (linhas.length === 1 && linhas[0].trim() === "") return []; // String vazia
                
                const cabecalho = linhas[0].split(',').map(header => header.trim());
                if (cabecalho.length === 0 || (cabecalho.length === 1 && cabecalho[0] === "")) {
                     console.warn("CSV com cabeçalho inválido ou vazio.");
                     return [];
                }
                const dados = [];

                for (let i = 1; i < linhas.length; i++) {
                    const linhaAtual = linhas[i].trim();
                    if (linhaAtual === "") continue;

                    const valores = [];
                    let valorAtual = '';
                    let dentroDeAspas = false;

                    for (let char of linhaAtual) {
                        if (char === '"' && (valorAtual.length === 0 || valorAtual[valorAtual.length - 1] !== '\\')) {
                            dentroDeAspas = !dentroDeAspas;
                        } else if (char === ',' && !dentroDeAspas) {
                            valores.push(valorAtual.trim().replace(/^"|"$/g, '').replace(/""/g, '"'));
                            valorAtual = '';
                        } else {
                            valorAtual += char;
                        }
                    }
                    valores.push(valorAtual.trim().replace(/^"|"$/g, '').replace(/""/g, '"'));

                    if (valores.length === cabecalho.length) {
                        const musica = {};
                        for (let j = 0; j < cabecalho.length; j++) {
                            musica[cabecalho[j]] = valores[j];
                        }
                        dados.push(musica);
                    } else {
                         console.warn(`Linha CSV ignorada (colunas não batem "${cabecalho.length}" vs "${valores.length}"):`, linhaAtual);
                    }
                }
                return dados;
            }

            function realizarBusca() {
                if (!areaResultadosPrincipal) return;
                 if (baseDeMusicas.length === 0) {
                    areaResultadosPrincipal.innerHTML = '<p>Nenhuma música carregada. Verifique os dados embutidos ou use o Painel Admin para adicionar.</p>';
                    return;
                }
                const termo = campoBusca.value.toLowerCase().trim();
                if (!termo) {
                    areaResultadosPrincipal.innerHTML = '<p>Digite algo para pesquisar...</p>';
                    return;
                }

                const resultadosFiltrados = baseDeMusicas.filter(musica => {
                    const numero = String(musica.Numero || '').toLowerCase();
                    const arquivo = String(musica.Arquivo || '').toLowerCase();
                    const cantor = String(musica.Cantor || '').toLowerCase();
                    const titulo = String(musica.Musica || '').toLowerCase();
                    return numero.includes(termo) || cantor.includes(termo) || titulo.includes(termo) || arquivo.includes(termo);
                });
                exibirResultados(resultadosFiltrados, areaResultadosPrincipal);
            }

            function exibirResultados(resultados, container) {
                if (!container) return;
                container.innerHTML = '';
                if (resultados.length === 0) {
                    container.innerHTML = '<p>Nenhum resultado encontrado.</p>';
                    return;
                }
                resultados.forEach(musica => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'song-item';
                    const musicaId = musica.Numero || `${musica.Musica}_${musica.Cantor}`;
                    itemDiv.innerHTML = `
                        <span class="song-code">Código: ${musica.Numero || 'N/D'}</span>
                        <h3 class="song-title">${musica.Musica || 'Título Desconhecido'}</h3>
                        <p class="song-artist">Cantor: ${musica.Cantor || 'Artista Desconhecido'}</p>
                        <p class="song-snippet">Arquivo: ${musica.Arquivo || 'Não informado'}</p>
                        <p class="song-snippet">Início: ${musica.TrechoInicial || 'Não disponível'}</p>
                        <button class="btn-favoritar" data-id="${musicaId}">
                            <i class="fas fa-star"></i> <span>Favoritar</span>
                        </button>
                    `;
                    container.appendChild(itemDiv);
                    const btnFavoritar = itemDiv.querySelector('.btn-favoritar');
                    btnFavoritar.addEventListener('click', toggleFavoritoHandler);
                    atualizarStatusBotaoFavorito(btnFavoritar, musicaId);
                });
            }

            function carregarFavoritosDoLocalStorage() {
                const favoritosSalvos = localStorage.getItem('appMusicasFavoritos');
                favoritos = favoritosSalvos ? JSON.parse(favoritosSalvos) : [];
            }

            function salvarFavoritosNoLocalStorage() {
                localStorage.setItem('appMusicasFavoritos', JSON.stringify(favoritos));
            }

            function toggleFavoritoHandler(event) {
                const botao = event.currentTarget;
                const musicaId = botao.dataset.id;
                if (!musicaId) return;

                const index = favoritos.indexOf(musicaId);
                if (index > -1) {
                    favoritos.splice(index, 1);
                } else {
                    favoritos.push(musicaId);
                }
                salvarFavoritosNoLocalStorage();
                atualizarStatusBotaoFavorito(botao, musicaId);

                if (document.querySelector('.bottom-nav .nav-item.active').id === 'navTabFavoritas') {
                    exibirTodasAsMusicasFavoritas();
                }
            }

            function atualizarStatusBotaoFavorito(botao, musicaId) {
                if (!botao || !musicaId) return;
                const texto = botao.querySelector('span');
                if (favoritos.includes(musicaId)) {
                    botao.classList.add('favoritado');
                    if (texto) texto.textContent = 'Desfavoritar';
                } else {
                    botao.classList.remove('favoritado');
                    if (texto) texto.textContent = 'Favoritar';
                }
            }

            function exibirTodasAsMusicasFavoritas() {
                if (!areaResultadosPrincipal) return;
                areaResultadosPrincipal.innerHTML = '';

                const headerFavoritas = document.createElement('h2');
                headerFavoritas.textContent = 'Minhas Favoritas';
                areaResultadosPrincipal.appendChild(headerFavoritas);

                if (baseDeMusicas.length === 0) {
                     areaResultadosPrincipal.innerHTML += '<p>Os dados das músicas ainda não foram carregados.</p>';
                    return;
                }
                if (favoritos.length === 0) {
                    areaResultadosPrincipal.innerHTML += '<p>Você ainda não adicionou nenhuma música aos favoritos.</p>';
                    return;
                }
                const musicasFavoritasVisiveis = baseDeMusicas.filter(musica => {
                    const musicaId = musica.Numero || `${musica.Musica}_${musica.Cantor}`;
                    return favoritos.includes(String(musicaId));
                });

                if (musicasFavoritasVisiveis.length === 0) {
                    areaResultadosPrincipal.innerHTML += '<p>Nenhuma música favorita para exibir no momento.</p>';
                    return;
                }
                exibirResultados(musicasFavoritasVisiveis, areaResultadosPrincipal);
            }

            // --- Lógica do Admin ---
            if (navAdminLogin) {
                navAdminLogin.addEventListener('click', (e) => {
                    e.preventDefault();
                    loginModal.style.display = 'block';
                    loginErrorMessage.textContent = ''; // Limpa msg de erro anterior
                    closeMenu(); // Fecha o menu lateral
                });
            }

            if (btnCloseLoginModal) {
                btnCloseLoginModal.addEventListener('click', () => {
                    loginModal.style.display = 'none';
                });
            }

            if (btnLogin) {
                btnLogin.addEventListener('click', () => {
                    const user = usernameInput.value;
                    const pass = passwordInput.value;
                    if (user === 'admin' && pass === 'admin') {
                        loginModal.style.display = 'none';
                        adminPanelModal.style.display = 'block';
                        csvDataTextarea.value = embeddedCsvData; // Carrega os dados atuais
                        adminStatusMessage.textContent = 'Dados carregados para edição.';
                        adminStatusMessage.style.color = '#ccc';
                    } else {
                        loginErrorMessage.textContent = 'Usuário ou senha inválidos!';
                    }
                });
            }

            if (btnCloseAdminPanel) {
                btnCloseAdminPanel.addEventListener('click', () => {
                    adminPanelModal.style.display = 'none';
                });
            }

            if (btnSaveChangesToSession) {
                btnSaveChangesToSession.addEventListener('click', () => {
                    embeddedCsvData = csvDataTextarea.value; // Salva o texto da textarea na variável global
                    updateStatus('Alterações salvas na sessão atual. Recarregue a lista ou copie o texto para salvar permanentemente.', adminStatusMessage);
                });
            }

            if (btnReloadMusicListAdmin) {
                btnReloadMusicListAdmin.addEventListener('click', () => {
                    // Primeiro, garante que os dados da textarea estão na variável embeddedCsvData
                    embeddedCsvData = csvDataTextarea.value;
                    updateStatus('Recarregando lista de músicas com os dados da área de edição...', adminStatusMessage);
                    carregarDadosEmbutidos(); // Re-parseia e atualiza a lista de músicas
                    // Poderia fechar o painel admin aqui se desejado, ou deixar aberto
                    // adminPanelModal.style.display = 'none';
                });
            }

            // Fecha modals ao clicar fora do conteúdo
            window.onclick = function(event) {
                if (event.target == loginModal) {
                    loginModal.style.display = "none";
                }
                if (event.target == adminPanelModal) {
                    adminPanelModal.style.display = "none";
                }
            }

            // --- Inicialização ---
            carregarFavoritosDoLocalStorage();
            carregarDadosEmbutidos();

            if (campoBusca) {
                campoBusca.addEventListener('input', () => {
                    clearTimeout(debounceTimer);
                    debounceTimer = setTimeout(realizarBusca, 300);
                });
            }

            bottomNavItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    bottomNavItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    const tabId = this.id;
                    if (campoBusca) campoBusca.value = '';

                    if (tabId === 'navTabMusicas') {
                        if (baseDeMusicas.length === 0) {
                            areaResultadosPrincipal.innerHTML = '<p>Nenhuma música carregada.</p>';
                        } else {
                            areaResultadosPrincipal.innerHTML = '<p>Digite algo para pesquisar...</p>';
                        }
                    } else if (tabId === 'navTabFavoritas') {
                        exibirTodasAsMusicasFavoritas();
                    } else {
                        if (areaResultadosPrincipal) areaResultadosPrincipal.innerHTML = `<h2>${this.querySelector('span').textContent}</h2><p>Conteúdo para ${this.querySelector('span').textContent}...</p>`;
                    }
                });
            });
        });
    </script>

</body>
</html>
